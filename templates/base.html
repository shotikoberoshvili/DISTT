<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="../static/images/logo.png">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{% block title %} {% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="../static/style.css">
    <script src="../static/chatbot.js" defer></script>
</head>
<body>
<header>
   {% include 'navbar.html' %}
</header>
<div class="container-md bg-white mt-4 border rounded shadow-lg">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% for category, message in messages %}
            <div class ="alert alert-{{category}}">
                {{message}}
            </div>
        {% endfor %}
    {% endwith %}

    {% block container %}

    {% endblock %}

  <button id="chatbot-toggle">ğŸ’¬</button>

<div id="chatbot-container" class="chatbot-container">

  <div class="chatbot-header">
    <h3>DIST Chatbot</h3>
    <button id="close-chatbot" class="chatbot-close">âœ–</button>
  </div>

  <div id="chatbot-messages" class="chatbot-body"></div>

  <div class="chatbot-input">
    <input id="chatbot-input-field" type="text" placeholder="áƒáƒ™áƒ áƒ˜áƒ¤áƒ” áƒ™áƒ˜áƒ—áƒ®áƒ•áƒ..." />
    <button id="send-message-btn">â¤</button>
  </div>

  <div id="typing-indicator" class="typing-indicator">
    <span class="typing-dot"></span>
    <span class="typing-dot"></span>
    <span class="typing-dot"></span>
  </div>

</div>



    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <div class="logo">
                          <a href="https://tbcbank.ge/ka/tbc-education" data-i18n="TBC"><img src="../static/images/tbc-logo.png" href="https://tbcbank.ge/ka/tbc-education" width="200px" alt="DroPay Logo" class="logo-image"></a>
                    </div>
                </div>
                <div class="footer-links">
                    <h3 data-i18n="links">áƒ‘áƒ›áƒ£áƒšáƒ”áƒ‘áƒ˜</h3>
                    <ul>
                        <li><a href="/" data-i18n="home">áƒ›áƒ—áƒáƒ•áƒáƒ áƒ˜</a></li>
                        <li><a href="/register" data-i18n="request">áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ</a></li>
                        <li><a href="/login" data-i18n="contact">áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ</a></li>
                    </ul>
                </div>
                <div class="footer-contact" id="contact">
                    <h3 data-i18n="contactTitle">áƒ™áƒáƒœáƒ¢áƒáƒ¥áƒ¢áƒ˜</h3>
                    <ul>
                        <li>áƒ”áƒš.áƒ¤áƒáƒ¡áƒ¢áƒ: infodistt@gmail.com</li>
                        <li>áƒ¢áƒ”áƒš: +995 599 326 577</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 DIST. <span data-i18n="copyright">áƒ§áƒ•áƒ”áƒšáƒ áƒ£áƒ¤áƒšáƒ”áƒ‘áƒ áƒ“áƒáƒªáƒ£áƒšáƒ˜áƒ.</span></p>
                <div class="social-links">
                    <a href="https://www.facebook.com/profile.php?id=61575906249858" aria-label="Facebook"><i>f</i></a>
                </div>
            </div>
        </div>
    </footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const toggleBtn = document.getElementById('chatbot-toggle');
        const windowEl = document.getElementById('chatbot-window');
        const closeBtn = document.querySelector('.chatbot-close');
        const form = document.getElementById('chatbot-form');
        const input = document.getElementById('chatbot-input');
        const messages = document.getElementById('chatbot-messages');
        let isSending = false;

        if (!toggleBtn || !windowEl || !form) {
            return;
        }

        toggleBtn.addEventListener('click', function () {
            windowEl.classList.toggle('chatbot-open');
        });

        closeBtn.addEventListener('click', function () {
            windowEl.classList.remove('chatbot-open');
        });

        function appendMessage(text, type) {
            const wrapper = document.createElement('div');
            wrapper.className = 'chat-message ' + (type === 'user' ? 'chat-message-user' : 'chat-message-bot');
            const bubble = document.createElement('div');
            bubble.className = 'chat-message-text';
            bubble.textContent = text;
            wrapper.appendChild(bubble);
            messages.appendChild(wrapper);
            messages.scrollTop = messages.scrollHeight;
        }

        form.addEventListener('submit', async function (e) {
            e.preventDefault();
            const text = (input.value || '').trim();
            if (!text || isSending) return;

            appendMessage(text, 'user');
            input.value = '';
            isSending = true;

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({message: text})
                });
                const data = await response.json();
                if (data.reply) {
                    appendMessage(data.reply, 'bot');
                } else {
                    appendMessage('áƒ“áƒáƒ¤áƒ˜áƒ¥áƒ¡áƒ˜áƒ áƒ“áƒ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ. áƒ¡áƒªáƒáƒ“áƒ” áƒ›áƒáƒ’áƒ•áƒ˜áƒáƒœáƒ”áƒ‘áƒ˜áƒ—.', 'bot');
                }
            } catch (err) {
                appendMessage('áƒ¥áƒ¡áƒ”áƒšáƒ£áƒ áƒ˜ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ. áƒ¡áƒªáƒáƒ“áƒ” áƒ™áƒ˜áƒ“áƒ”áƒ• áƒ”áƒ áƒ—áƒ®áƒ”áƒš.', 'bot');
            } finally {
                isSending = false;
            }
        });
    });
</script>
</body>
</html>