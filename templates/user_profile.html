{% extends "base.html"%}
{% block title %} {{ user.name }} - áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜ {% endblock %}
{% block container %}
<div class="container-md bg-white mt-4 border rounded shadow-lg">
    <div class="row">
        <div class="col-12">
            <!-- Profile Header -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 text-center">
                            <img src="/static/images/{{ user.profile_img }}" alt="{{ user.name }}" class="rounded-circle mb-3" style="width: 150px; height: 150px; object-fit: cover;">
                            <h4>{{ user.name }}</h4>
                            <p class="text-muted">{{ user.role }}</p>
                            
                            {% if current_user.is_authenticated and current_user.id != user.id %}
                                {% if friendship_status == 'friends' %}
                                    <span class="badge bg-success">ğŸ‘¥ áƒ›áƒ”áƒ’áƒáƒ‘áƒ áƒ”áƒ‘áƒ˜ áƒ®áƒáƒ áƒ—</span>
                                {% elif friendship_status == 'sent' %}
                                    <span class="badge bg-warning">ğŸ“¤ áƒ›áƒáƒ—áƒ®áƒáƒ•áƒœáƒ áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ˜áƒšáƒ˜áƒ</span>
                                {% elif friendship_status == 'received' %}
                                    <div class="mt-2">
                                        {% for request in received_requests %}
                                        {% if request.requester_id == user.id %}
                                        <a href="/respond_friend_request/{{ request.id }}/accept" class="btn btn-success btn-sm">âœ“ áƒ“áƒáƒ“áƒáƒ¡áƒ¢áƒ£áƒ áƒ”áƒ‘áƒ</a>
                                        <a href="/respond_friend_request/{{ request.id }}/reject" class="btn btn-outline-danger btn-sm">âœ— áƒ£áƒáƒ áƒ§áƒáƒ¤áƒ</a>
                                        {% endif %}
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <a href="/send_friend_request/{{ user.id }}" class="btn btn-primary">ğŸ‘‹ áƒ›áƒ”áƒ’áƒáƒ‘áƒ áƒáƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ</a>
                                {% endif %}
                                
                                <a href="/chat/{{ user.id }}" class="btn btn-outline-success d-block mt-2">ğŸ’¬ áƒ¨áƒ”áƒ¢áƒ§áƒáƒ‘áƒ˜áƒœáƒ”áƒ‘áƒ</a>
                            {% endif %}
                        </div>
                        <div class="col-md-9">
                            <h5>áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ</h5>
                            <p><strong>áƒ”áƒš.áƒ¤áƒáƒ¡áƒ¢áƒ:</strong> {{ user.email }}</p>
                            <p><strong>áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜:</strong> {{ user.phone_number }}</p>
                            <p><strong>áƒ£áƒœáƒ˜áƒ•áƒ”áƒ áƒ¡áƒ˜áƒ¢áƒ”áƒ¢áƒ˜:</strong> {{ user.university or "áƒ›áƒ˜áƒ—áƒ˜áƒ—áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒáƒ áƒáƒ" }}</p>
                            <p><strong>áƒ¤áƒáƒ™áƒ£áƒšáƒ¢áƒ”áƒ¢áƒ˜:</strong> {{ user.faculty or "áƒ›áƒ˜áƒ—áƒ˜áƒ—áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒáƒ áƒáƒ" }}</p>
                            <p><strong>áƒ©áƒ”áƒ›áƒ¡ áƒ¨áƒ”áƒ¡áƒáƒ®áƒ”áƒ‘:</strong></p>
                            <p>{{ user.text or "áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ áƒáƒ  áƒáƒ áƒ˜áƒ¡" }}</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- User's Posts -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">ğŸ“ {{ user.name }}-áƒ˜áƒ¡ áƒáƒáƒ¡áƒ¢áƒ”áƒ‘áƒ˜</h5>
                </div>
                <div class="card-body">
                    {% if posts %}
                        {% for post in posts %}
                        <div class="card mb-3">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-3">
                                    <img src="/static/images/{{ post.user.profile_img }}" alt="{{ post.user.name }}" class="rounded-circle me-3" style="width: 40px; height: 40px; object-fit: cover;">
                                    <div>
                                        <h6 class="mb-0">{{ post.user.name }}</h6>
                                        <small class="text-muted">{{ post.created_at.strftime('%d %b %Y, %H:%M') }}</small>
                                        {% if post.updated_at != post.created_at %}
                                        <small class="text-muted">â€¢ áƒ’áƒáƒœáƒáƒ®áƒšáƒ“áƒ</small>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <p class="card-text">{{ post.content }}</p>
                                
                                {% if post.images %}
                                <div class="mb-3">
                                    {% for image in post.images %}
                                    <img src="/static/images/{{ image.image_path }}" class="img-fluid rounded" alt="Post image">
                                    {% endfor %}
                                </div>
                                {% endif %}
                                
                                <div class="d-flex align-items-center">
                                    {% if current_user.is_authenticated %}
                                    <form method="POST" action="/react/{{ post.id }}/like" class="me-3">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                        <button type="submit" class="btn btn-sm btn-outline-primary">
                                            ğŸ‘ áƒ›áƒáƒ¬áƒáƒœáƒ”áƒ‘áƒ 
                                            {% set like_count = post.reactions.filter_by(reaction_type='like').count() %}
                                            {% if like_count > 0 %}({{ like_count }}){% endif %}
                                        </button>
                                    </form>
                                    <form method="POST" action="/react/{{ post.id }}/support" class="me-3">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                        <button type="submit" class="btn btn-sm btn-outline-success">
                                            ğŸ¤— áƒ›áƒ®áƒáƒ áƒ“áƒáƒ­áƒ”áƒ áƒ 
                                            {% set support_count = post.reactions.filter_by(reaction_type='support').count() %}
                                            {% if support_count > 0 %}({{ support_count }}){% endif %}
                                        </button>
                                    </form>
                                    {% else %}
                                    <span class="text-muted me-3">ğŸ‘ áƒ›áƒáƒ¬áƒáƒœáƒ”áƒ‘áƒ ({{ post.reactions.filter_by(reaction_type='like').count() }})</span>
                                    <span class="text-muted me-3">ğŸ¤— áƒ›áƒ®áƒáƒ áƒ“áƒáƒ­áƒ”áƒ áƒ ({{ post.reactions.filter_by(reaction_type='support').count() }})</span>
                                    {% endif %}
                                    <span class="text-muted">
                                        ğŸ’¬ {{ post.comments.count() }} áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ˜
                                    </span>
                                </div>
                                
                                <!-- Comments Section -->
                                {% if post.comments.count() > 0 %}
                                <div class="mt-3 border-top pt-3">
                                    {% for comment in post.comments.limit(3) %}
                                    <div class="d-flex mb-2">
                                        <img src="/static/images/{{ comment.user.profile_img }}" alt="{{ comment.user.name }}" class="rounded-circle me-2" style="width: 32px; height: 32px; object-fit: cover;">
                                        <div class="flex-grow-1">
                                            <small class="fw-bold">{{ comment.user.name }}</small>
                                            <p class="mb-1 small">{{ comment.content }}</p>
                                            <small class="text-muted">{{ comment.created_at.strftime('%d %b %Y, %H:%M') }}</small>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}
                                
                                {% if current_user.is_authenticated %}
                                <form method="POST" action="/add_comment/{{ post.id }}" class="mt-3">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                    <div class="d-flex">
                                        <img src="/static/images/{{ current_user.profile_img }}" alt="{{ current_user.name }}" class="rounded-circle me-2" style="width: 32px; height: 32px; object-fit: cover;">
                                        <input type="text" name="content" class="form-control form-control-sm" placeholder="áƒ“áƒáƒ¬áƒ”áƒ áƒ” áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ˜..." required>
                                        <button type="submit" class="btn btn-sm btn-primary ms-2">áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ</button>
                                    </div>
                                </form>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted">áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ¡ áƒ¯áƒ”áƒ  áƒáƒáƒ¡áƒ¢áƒ”áƒ‘áƒ˜ áƒáƒ  áƒáƒ¥áƒ•áƒ¡</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
