{% extends "base.html"%}
{% block title %} áƒ›áƒ—áƒáƒ•áƒáƒ áƒ˜ {% endblock %}
{% block container %}
<div class="container-md bg-white mt-2 border rounded shadow-lg">
    <div class="row mt-2">
        <div id="carouselExampleIndicators" class="carousel slide">
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0"
                        class="active" aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1"
                        aria-label="Slide 2"></button>
                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2"
                        aria-label="Slide 3"></button>
               
            </div>
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img src="../static/images/edu.jpg"
                         class="d-block w-100"  alt="...">
                </div>
                <div class="carousel-item">
                    <img src="../static/images/edu2.jpg"
                         class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item">
                    <img src="../static/images/edu3.jpg"
                         class="d-block w-100" alt="...">
                </div>
                
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators"
                    data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators"
                    data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>
    
</div>   
<hr class="my-4">

<!-- LinkedIn-style Feed -->
<div class="container-md bg-white mt-4 border rounded shadow-lg">
    {% if current_user.is_authenticated %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <form method="POST" action="/create_post">
                        {{ form.hidden_tag() }}
                        <div class="d-flex">
                            <img src="/static/images/{{ current_user.profile_img }}" alt="{{ current_user.name }}" class="rounded-circle me-3" style="width: 48px; height: 48px; object-fit: cover;">
                            <div class="flex-grow-1">
                                {{ form.content(class="form-control", placeholder="áƒ áƒáƒ¡ áƒ¤áƒ˜áƒ¥áƒ áƒáƒ‘áƒ—?", rows="3") }}
                                <div class="mt-2">
                                    {{ form.submit(class="btn btn-primary btn-sm") }}
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="row">
        <div class="col-12">
            <h5 class="mb-4">ğŸ“ áƒáƒáƒ¡áƒ¢áƒ”áƒ‘áƒ˜áƒ¡ Feed</h5>
            {% for post in posts %}
            <div class="card mb-3">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <img src="/static/images/{{ post.user.profile_img }}" alt="{{ post.user.name }}" class="rounded-circle me-3" style="width: 48px; height: 48px; object-fit: cover;">
                        <div>
                            <h6 class="mb-0"><a href="/profile/{{ post.user.id }}" class="text-decoration-none">{{ post.user.name }}</a></h6>
                            <small class="text-muted">{{ post.created_at.strftime('%d %b %Y, %H:%M') }}</small>
                            {% if post.updated_at != post.created_at %}
                            <small class="text-muted">â€¢ áƒ’áƒáƒœáƒáƒ®áƒšáƒ“áƒ</small>
                            {% endif %}
                        </div>
                        {% if current_user.is_authenticated and post.user_id == current_user.id %}
                        <div class="ms-auto">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    áƒ›áƒáƒ¥áƒ›áƒ”áƒ“áƒ”áƒ‘áƒ”áƒ‘áƒ˜
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="/edit_post/{{ post.id }}">áƒ áƒ”áƒ“áƒáƒ¥áƒ¢áƒ˜áƒ áƒ”áƒ‘áƒ</a></li>
                                    <li><a class="dropdown-item text-danger" href="/delete_post/{{ post.id }}">áƒ¬áƒáƒ¨áƒšáƒ</a></li>
                                </ul>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <p class="card-text">{{ post.content }}</p>
                    
                    {% if post.images %}
                    <div class="mb-3">
                        {% for image in post.images %}
                        <img src="/static/images/{{ image.image_path }}" class="img-fluid rounded" alt="Post image">
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center">
                            {% if current_user.is_authenticated %}
                            <form method="POST" action="/react/{{ post.id }}/like" class="me-3">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                <button type="submit" class="btn btn-sm btn-outline-primary">
                                    ğŸ‘ áƒ›áƒáƒ¬áƒáƒœáƒ”áƒ‘áƒ 
                                    {% set like_count = post.reactions.filter_by(reaction_type='like').count() %}
                                    {% if like_count > 0 %}({{ like_count }}){% endif %}
                                </button>
                            </form>
                            <form method="POST" action="/react/{{ post.id }}/support" class="me-3">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                <button type="submit" class="btn btn-sm btn-outline-success">
                                    ğŸ¤— áƒ›áƒ®áƒáƒ áƒ“áƒáƒ­áƒ”áƒ áƒ 
                                    {% set support_count = post.reactions.filter_by(reaction_type='support').count() %}
                                    {% if support_count > 0 %}({{ support_count }}){% endif %}
                                </button>
                            </form>
                            {% else %}
                            <span class="text-muted me-3">ğŸ‘ áƒ›áƒáƒ¬áƒáƒœáƒ”áƒ‘áƒ ({{ post.reactions.filter_by(reaction_type='like').count() }})</span>
                            <span class="text-muted me-3">ğŸ¤— áƒ›áƒ®áƒáƒ áƒ“áƒáƒ­áƒ”áƒ áƒ ({{ post.reactions.filter_by(reaction_type='support').count() }})</span>
                            {% endif %}
                            <span class="text-muted">
                                ğŸ’¬ <span id="comment-count-{{ post.id }}">{{ post.comments.count() }}</span> áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ˜
                            </span>
                        </div>
                        
                        <!-- Reactions summary -->
                        {% if post.reactions.count() > 0 %}
                        <div class="dropdown">
                            <button type="button" class="btn btn-link p-0 text-muted small" data-bs-toggle="dropdown">
                                {% set total_reactions = post.reactions.count() %}
                                {% if total_reactions > 0 %}
                                <div class="d-flex align-items-center">
                                    {% if post.reactions.filter_by(reaction_type='like').count() > 0 %}
                                    <span class="me-1">ğŸ‘</span>
                                    {% endif %}
                                    {% if post.reactions.filter_by(reaction_type='support').count() > 0 %}
                                    <span class="me-1">ğŸ¤—</span>
                                    {% endif %}
                                    <span>{{ total_reactions }}</span>
                                </div>
                                {% endif %}
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" style="min-width: 200px;">
                                {% for reaction in post.reactions.limit(10) %}
                                <li>
                                    <div class="d-flex align-items-center p-2">
                                        <img src="/static/images/{{ reaction.user.profile_img }}" alt="{{ reaction.user.name }}" class="rounded-circle me-2" style="width: 24px; height: 24px; object-fit: cover;">
                                        <a href="/profile/{{ reaction.user.id }}" class="text-decoration-none">{{ reaction.user.name }}</a>
                                        <span class="ms-auto">
                                            {% if reaction.reaction_type == 'like' %}ğŸ‘
                                            {% elif reaction.reaction_type == 'support' %}ğŸ¤—{% endif %}
                                        </span>
                                    </div>
                                </li>
                                {% endfor %}
                                {% if post.reactions.count() > 10 %}
                                <li><hr class="dropdown-divider"></li>
                                <li><div class="text-center p-2 text-muted small">áƒ“áƒ áƒ™áƒ˜áƒ“áƒ”áƒ• {{ post.reactions.count() - 10 }} áƒáƒ“áƒáƒ›áƒ˜áƒáƒœáƒ˜</div></li>
                                {% endif %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Comments Section -->
                    <div class="mt-3 border-top pt-3" id="comments-section-{{ post.id }}">
                        {% if post.comments.count() > 0 %}
                        <div class="mb-3">
                            {% if post.comments.count() > 3 %}
                            <button type="button" class="btn btn-link p-0 text-secondary small" onclick="toggleAllComments({{ post.id }})">
                                áƒœáƒáƒ®áƒ•áƒ {{ post.comments.count() - 3 }} áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ˜áƒ¡ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ—
                            </button>
                            {% endif %}
                            
                            <div id="comments-list-{{ post.id }}">
                            {% for comment in post.comments.limit(3) %}
                            <div class="d-flex mb-3" id="comment-{{ comment.id }}">
                                <img src="/static/images/{{ comment.user.profile_img }}" alt="{{ comment.user.name }}" class="rounded-circle me-2" style="width: 36px; height: 36px; object-fit: cover;">
                                <div class="flex-grow-1">
                                    <div class="bg-light rounded-3 p-2">
                                        <div class="d-flex align-items-center mb-1">
                                            <a href="/profile/{{ comment.user.id }}" class="text-decoration-none fw-bold small">{{ comment.user.name }}</a>
                                            <small class="text-muted ms-2">{{ comment.created_at.strftime('%d %b %Y, %H:%M') }}</small>
                                            {% if current_user.is_authenticated and comment.user_id == current_user.id %}
                                            <form method="POST" action="/delete_comment/{{ comment.id }}" style="display: inline;">
                                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                                <button type="submit" class="btn btn-sm btn-link text-danger p-0 ms-auto" onclick="return confirm('áƒ“áƒáƒ áƒ¬áƒ›áƒ£áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ®áƒáƒ , áƒ áƒáƒ› áƒ’áƒ¡áƒ£áƒ áƒ¡ áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ?')">
                                                    <small>áƒ¬áƒáƒ¨áƒšáƒ</small>
                                                </button>
                                            </form>
                                            {% endif %}
                                        </div>
                                        <p class="mb-0 small">{{ comment.content }}</p>
                                    </div>
                                    <div class="d-flex align-items-center mt-1 ms-3">
                                        {% if current_user.is_authenticated %}
                                        <div class="dropdown">
                                            <button class="btn btn-link p-0 text-muted small dropdown-toggle" type="button" id="commentReactionDropdown{{ comment.id }}" data-bs-toggle="dropdown" aria-expanded="false">
                                                ğŸ˜Š áƒ áƒ”áƒáƒ¥áƒªáƒ˜áƒ 
                                                {% set comment_total_reactions = comment.reactions.count() %}
                                                {% if comment_total_reactions > 0 %}({{ comment_total_reactions }}){% endif %}
                                            </button>
                                            <ul class="dropdown-menu" aria-labelledby="commentReactionDropdown{{ comment.id }}">
                                                <li><form method="POST" action="/react_comment/{{ comment.id }}/like" style="display: inline;"><input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/><button type="submit" class="dropdown-item">ğŸ‘ áƒ›áƒáƒ¬áƒáƒœáƒ”áƒ‘áƒ</button></form></li>
                                                <li><form method="POST" action="/react_comment/{{ comment.id }}/love" style="display: inline;"><input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/><button type="submit" class="dropdown-item">â¤ï¸ áƒ¡áƒ˜áƒ§áƒ•áƒáƒ áƒ£áƒšáƒ˜</button></form></li>
                                                <li><form method="POST" action="/react_comment/{{ comment.id }}/laugh" style="display: inline;"><input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/><button type="submit" class="dropdown-item">ğŸ˜„ áƒ®áƒ›áƒ˜áƒáƒ áƒ”áƒ‘áƒ</button></form></li>
                                                <li><form method="POST" action="/react_comment/{{ comment.id }}/angry" style="display: inline;"><input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/><button type="submit" class="dropdown-item">ğŸ˜  áƒ’áƒáƒ‘áƒ áƒáƒ–áƒ”áƒ‘áƒ</button></form></li>
                                            </ul>
                                        </div>
                                        
                                        <!-- Debug: Show current user reactions -->
                                        {% if current_user.is_authenticated %}
                                        {% set user_reaction = comment.reactions.filter_by(user_id=current_user.id).first() %}
                                        {% if user_reaction %}
                                        <small class="text-muted ms-2">áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ áƒ”áƒáƒ¥áƒªáƒ˜áƒ: {{ user_reaction.reaction_type }}</small>
                                        {% endif %}
                                        {% endif %}
                                        {% else %}
                                        <span class="text-muted small">ğŸ˜Š áƒ áƒ”áƒáƒ¥áƒªáƒ˜áƒ ({{ comment.reactions.count() }})</span>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Reply functionality removed -->
                                    
                                    <!-- Reply display removed -->
                                    <!-- No replies will be shown -->
                                </div>
                            </div>
                            {% endfor %}
                            </div>
                            
                            <!-- Hidden comments for "View more" functionality -->
                            <div id="hidden-comments-{{ post.id }}" style="display: none;">
                            {% for comment in post.comments.offset(3) %}
                            <div class="d-flex mb-3" id="comment-{{ comment.id }}">
                                <img src="/static/images/{{ comment.user.profile_img }}" alt="{{ comment.user.name }}" class="rounded-circle me-2" style="width: 36px; height: 36px; object-fit: cover;">
                                <div class="flex-grow-1">
                                    <div class="bg-light rounded-3 p-2">
                                        <div class="d-flex align-items-center mb-1">
                                            <a href="/profile/{{ comment.user.id }}" class="text-decoration-none fw-bold small">{{ comment.user.name }}</a>
                                            <small class="text-muted ms-2">{{ comment.created_at.strftime('%d %b %Y, %H:%M') }}</small>
                                            {% if current_user.is_authenticated and comment.user_id == current_user.id %}
                                            <form method="POST" action="/delete_comment/{{ comment.id }}" style="display: inline;">
                                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                                <button type="submit" class="btn btn-sm btn-link text-danger p-0 ms-auto" onclick="return confirm('áƒ“áƒáƒ áƒ¬áƒ›áƒ£áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ®áƒáƒ , áƒ áƒáƒ› áƒ’áƒ¡áƒ£áƒ áƒ¡ áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ?')">
                                                    <small>áƒ¬áƒáƒ¨áƒšáƒ</small>
                                                </button>
                                            </form>
                                            {% endif %}
                                        </div>
                                        <p class="mb-0 small">{{ comment.content }}</p>
                                    </div>
                                    <div class="d-flex align-items-center mt-1 ms-3">
                                        {% if current_user.is_authenticated %}
                                        <div class="dropdown">
                                            <button class="btn btn-link p-0 text-muted small dropdown-toggle" type="button" id="commentReactionDropdown{{ comment.id }}" data-bs-toggle="dropdown" aria-expanded="false">
                                                ğŸ˜Š áƒ áƒ”áƒáƒ¥áƒªáƒ˜áƒ 
                                                {% set comment_total_reactions = comment.reactions.count() %}
                                                {% if comment_total_reactions > 0 %}({{ comment_total_reactions }}){% endif %}
                                            </button>
                                            <ul class="dropdown-menu" aria-labelledby="commentReactionDropdown{{ comment.id }}">
                                                <li><form method="POST" action="/react_comment/{{ comment.id }}/like" style="display: inline;"><input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/><button type="submit" class="dropdown-item">ğŸ‘ áƒ›áƒáƒ¬áƒáƒœáƒ”áƒ‘áƒ</button></form></li>
                                                <li><form method="POST" action="/react_comment/{{ comment.id }}/love" style="display: inline;"><input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/><button type="submit" class="dropdown-item">â¤ï¸ áƒ¡áƒ˜áƒ§áƒ•áƒáƒ áƒ£áƒšáƒ˜</button></form></li>
                                                <li><form method="POST" action="/react_comment/{{ comment.id }}/laugh" style="display: inline;"><input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/><button type="submit" class="dropdown-item">ğŸ˜„ áƒ®áƒ›áƒ˜áƒáƒ áƒ”áƒ‘áƒ</button></form></li>
                                                <li><form method="POST" action="/react_comment/{{ comment.id }}/angry" style="display: inline;"><input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/><button type="submit" class="dropdown-item">ğŸ˜  áƒ’áƒáƒ‘áƒ áƒáƒ–áƒ”áƒ‘áƒ</button></form></li>
                                            </ul>
                                        </div>
                                        
                                        <!-- Debug: Show current user reactions -->
                                        {% if current_user.is_authenticated %}
                                        {% set user_reaction = comment.reactions.filter_by(user_id=current_user.id).first() %}
                                        {% if user_reaction %}
                                        <small class="text-muted ms-2">áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ áƒ”áƒáƒ¥áƒªáƒ˜áƒ: {{ user_reaction.reaction_type }}</small>
                                        {% endif %}
                                        {% endif %}
                                        {% else %}
                                        <span class="text-muted small">ğŸ˜Š áƒ áƒ”áƒáƒ¥áƒªáƒ˜áƒ ({{ comment.reactions.count() }})</span>
                                        {% endif %}
                                    </div>
                                    
                                    </div>
                            {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    {% if current_user.is_authenticated %}
                    <form method="POST" action="/add_comment/{{ post.id }}" class="mt-3">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <div class="d-flex">
                            <img src="/static/images/{{ current_user.profile_img }}" alt="{{ current_user.name }}" class="rounded-circle me-2" style="width: 32px; height: 32px; object-fit: cover;">
                            <input type="text" name="content" class="form-control form-control-sm" placeholder="áƒ“áƒáƒ¬áƒ”áƒ áƒ” áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ˜..." required>
                            <button type="submit" class="btn btn-sm btn-primary ms-2">áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ</button>
                        </div>
                    </form>
                    {% endif %}
                </div>
            </div>
            {% else %}
            <div class="text-center py-5">
                <p class="text-muted">áƒ¯áƒ”áƒ  áƒáƒáƒ¡áƒ¢áƒ”áƒ‘áƒ˜ áƒáƒ  áƒáƒ áƒ˜áƒ¡. áƒ˜áƒ§áƒáƒ•áƒ˜ áƒáƒ˜áƒ áƒ•áƒ”áƒšáƒ˜ áƒ•áƒ˜áƒœáƒª áƒ’áƒáƒáƒ–áƒ˜áƒáƒ áƒ”áƒ‘áƒ¡ áƒ áƒáƒ˜áƒ›áƒ”áƒ¡!</p>
                {% if not current_user.is_authenticated %}
                <a href="/register" class="btn btn-primary">áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ</a>
                <a href="/login" class="btn btn-outline-primary ms-2">áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ</a>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</div>
<div class="row mt-4">
        <div class="col-12 text-center py-3">
            <h1 class="home-hero-title mb-2">DIST â€“ áƒ¡áƒ¢áƒ£áƒ“áƒ”áƒœáƒ¢áƒ£áƒ áƒ˜ áƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ˜áƒœáƒ’áƒ˜</h1>
            <p class="text-muted mb-3">
                áƒ›áƒáƒ áƒ¢áƒ˜áƒ•áƒ˜ áƒ¡áƒ˜áƒ•áƒ áƒªáƒ”, áƒ¡áƒáƒ“áƒáƒª áƒ¡áƒ¢áƒ£áƒ“áƒ”áƒœáƒ¢áƒ”áƒ‘áƒ˜ áƒ”áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ˜áƒáƒœ áƒ¡áƒ¢áƒ£áƒ“áƒ”áƒœáƒ¢áƒ”áƒ‘áƒ¡ áƒ“áƒ áƒ¡áƒ¬áƒáƒ•áƒšáƒ áƒ®áƒ“áƒ”áƒ‘áƒ áƒ£áƒ¤áƒ áƒ áƒ›áƒ¨áƒ•áƒ˜áƒ“áƒ˜.
            </p>
            <div class="d-flex justify-content-center gap-2 flex-wrap">
                <a href="/register" class="btn btn-outline-success">áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ</a>
            </div>
        </div>
    </div>
    
    <!-- Features Section -->
    <section id="features" class="features">
        <div class="container-md ">
            <h2 class="section-title" data-i18n="whyChoose">áƒ áƒáƒ¢áƒáƒ› DIST?</h2>
            <div class="features-grid">
                <div class="feature-card shadow-lg " >
                    <div class="feature-icon">ğŸš€</div>
                    <h3 data-i18n="fast">áƒ˜áƒœáƒáƒ•áƒáƒªáƒ˜áƒ£áƒ áƒ˜</h3>
                    <p data-i18n="fastDesc">áƒ¡áƒ¢áƒ£áƒ“áƒ”áƒœáƒ¢áƒ˜ áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒª áƒ”áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ áƒ¡áƒ¢áƒ£áƒ“áƒ”áƒœáƒ¢áƒ¡</p>
                </div>
                <div class="feature-card shadow-lg">
                    <div class="feature-icon">ğŸ”’</div>
                    <h3 data-i18n="secure">áƒ£áƒ¡áƒáƒ¤áƒ áƒ—áƒ®áƒ</h3>
                    <p data-i18n="secureDesc">áƒ“áƒáƒªáƒ£áƒšáƒ˜ áƒ™áƒáƒ›áƒ£áƒœáƒ˜áƒ™áƒáƒªáƒ˜áƒ áƒ“áƒ áƒ¡áƒ¬áƒáƒ•áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ¦áƒáƒšáƒ˜ áƒ¡áƒ¢áƒáƒœáƒ“áƒáƒ áƒ¢áƒ˜</p>
                </div>
                <div class="feature-card shadow-lg">
                    <div class="feature-icon">ğŸ‘¥</div>
                    <h3 data-i18n="versatile">áƒ›áƒ®áƒáƒ áƒ“áƒáƒ­áƒ”áƒ áƒ</h3>
                    <p data-i18n="versatileDesc">áƒ›áƒ®áƒáƒ áƒ“áƒáƒ­áƒ”áƒ áƒ áƒšáƒ”áƒ¥áƒ¢áƒáƒ áƒ”áƒ‘áƒ˜áƒ“áƒáƒœ</p>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

<script>
async function handleReaction(postId, reactionType) {
    console.log(`DEBUG: Handling reaction for post ${postId} with ${reactionType}`);
    try {
        const response = await fetch(`/react/${postId}/${reactionType}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            }
        });
        
        const data = await response.json();
        console.log('DEBUG: Reaction response:', data);
        
        if (data.success) {
            // Update reaction counts
            const likeCount = document.getElementById(`like-count-${postId}`);
            const supportCount = document.getElementById(`support-count-${postId}`);
            
            likeCount.textContent = data.like_count > 0 ? `(${data.like_count})` : '';
            supportCount.textContent = data.support_count > 0 ? `(${data.support_count})` : '';
            
            // Update button states
            const likeBtn = likeCount.parentElement;
            const supportBtn = supportCount.parentElement;
            
            // Reset button states
            likeBtn.classList.remove('btn-primary');
            likeBtn.classList.add('btn-outline-primary');
            supportBtn.classList.remove('btn-success');
            supportBtn.classList.add('btn-outline-success');
            
            // Set active state for current reaction
            if (data.user_reaction === 'like') {
                likeBtn.classList.remove('btn-outline-primary');
                likeBtn.classList.add('btn-primary');
            } else if (data.user_reaction === 'support') {
                supportBtn.classList.remove('btn-outline-success');
                supportBtn.classList.add('btn-success');
            }
            
            // Update the reactions summary dropdown
            updateReactionsSummary(postId);
        }
    } catch (error) {
        console.error('Error:', error);
    }
}

async function handleComment(event, postId) {
    event.preventDefault();
    
    const form = event.target;
    const contentInput = form.querySelector('input[name="content"]');
    const content = contentInput.value.trim();
    
    console.log(`DEBUG: Adding comment to post ${postId}: "${content}"`);
    
    if (!content) return;
    
    try {
        const response = await fetch(`/add_comment/${postId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            },
            body: JSON.stringify({ 
                content: content
            })
        });
        
        const data = await response.json();
        console.log('DEBUG: Comment response:', data);
        
        if (data.success) {
            // Add new comment to the DOM
            const commentsSection = document.getElementById(`comments-section-${postId}`);
            const commentsList = document.getElementById(`comments-list-${postId}`);
            const newComment = document.createElement('div');
            newComment.className = 'd-flex mb-3';
            newComment.id = `comment-${data.comment.id}`;
            newComment.innerHTML = `
                <img src="/static/images/${data.comment.user_profile_img}" alt="${data.comment.user_name}" class="rounded-circle me-2" style="width: 36px; height: 36px; object-fit: cover;">
                <div class="flex-grow-1">
                    <div class="bg-light rounded-3 p-2">
                        <div class="d-flex align-items-center mb-1">
                            <a href="/profile/${current_user.id}" class="text-decoration-none fw-bold small">${data.comment.user_name}</a>
                            <small class="text-muted ms-2">${data.comment.created_at}</small>
                            <button type="button" class="btn btn-sm btn-link text-danger p-0 ms-auto" onclick="deleteComment(${data.comment.id}, ${postId})">
                                <small>áƒ¬áƒáƒ¨áƒšáƒ</small>
                            </button>
                        </div>
                        <p class="mb-0 small">${data.comment.content}</p>
                    </div>
                    <div class="d-flex align-items-center mt-1 ms-3">
                        <button type="button" class="btn btn-link p-0 text-muted small">áƒ›áƒáƒ¬áƒáƒœáƒ”áƒ‘áƒ</button>
                        <button type="button" class="btn btn-link p-0 text-muted small ms-3">áƒáƒáƒ¡áƒ£áƒ®áƒ˜</button>
                    </div>
                </div>
            `;
            
            commentsList.appendChild(newComment);
            
            // Update comment count
            const commentCount = document.getElementById(`comment-count-${postId}`);
            const currentCount = parseInt(commentCount.textContent) || 0;
            commentCount.textContent = currentCount + 1;
            
            // Clear form
            form.reset();
        }
    } catch (error) {
        console.error('Error:', error);
    }
}

async function deleteComment(commentId, postId) {
    if (!confirm('áƒ“áƒáƒ áƒ¬áƒ›áƒ£áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ®áƒáƒ , áƒ áƒáƒ› áƒ’áƒ¡áƒ£áƒ áƒ¡ áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ?')) return;
    
    try {
        const response = await fetch(`/delete_comment/${commentId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            // Remove comment from DOM
            const commentElement = document.getElementById(`comment-${commentId}`);
            commentElement.remove();
            
            // Update comment count
            const commentCount = document.getElementById(`comment-count-${postId}`);
            const currentCount = parseInt(commentCount.textContent) || 0;
            commentCount.textContent = Math.max(0, currentCount - 1);
        }
    } catch (error) {
        console.error('Error:', error);
    }
}

// Update reactions summary dropdown
async function updateReactionsSummary(postId) {
    try {
        const response = await fetch(`/reactions/${postId}`);
        const data = await response.json();
        
        if (data.success) {
            // This would require a new route to get updated reactions
            // For now, we'll just reload the page to show updated reactions
            // In a production app, you'd update the DOM dynamically
            console.log('Reactions updated:', data);
        }
    } catch (error) {
        console.error('Error updating reactions summary:', error);
    }
}

// Toggle reply form visibility - REMOVED
// Reply functionality has been disabled

// Toggle all comments visibility
function toggleAllComments(postId) {
    const hiddenComments = document.getElementById(`hidden-comments-${postId}`);
    const button = event.target;
    
    if (hiddenComments.style.display === 'none') {
        hiddenComments.style.display = 'block';
        button.textContent = 'áƒœáƒáƒ™áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ©áƒ•áƒ”áƒœáƒ”áƒ‘áƒ';
    } else {
        hiddenComments.style.display = 'none';
        button.textContent = `áƒœáƒáƒ®áƒ•áƒ ${button.getAttribute('data-count')} áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ˜áƒ¡ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ—`;
    }
}

// Check for notifications periodically
async function checkNotifications() {
    try {
        const response = await fetch('/notifications/count');
        const data = await response.json();
        
        // Update notification badge if it exists
        const notificationBadge = document.getElementById('notification-badge');
        if (notificationBadge) {
            notificationBadge.textContent = data.count > 0 ? data.count : '';
            notificationBadge.style.display = data.count > 0 ? 'inline' : 'none';
        }
    } catch (error) {
        console.error('Error checking notifications:', error);
    }
}

// Check notifications every 30 seconds
setInterval(checkNotifications, 30000);

// Initial check
document.addEventListener('DOMContentLoaded', checkNotifications);
</script>



